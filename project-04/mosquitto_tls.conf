# =============================================================================
# Mosquitto Configuration: TLS SECURED
# =============================================================================
#
# Use this configuration for:
# - Encrypted MQTT connections (MQTTS)
# - Production-like security testing
# - TLS performance experiments
#
# Before using this configuration:
# 1. Run generate_certs.py to create certificates
# 2. Ensure certs/ folder contains: ca.pem, server.pem, server-key.pem
#
# Start with: mosquitto -c mosquitto_tls.conf -v
# =============================================================================

# -----------------------------------------------------------------------------
# Network Settings
# -----------------------------------------------------------------------------

# MQTT over TLS port (standard MQTTS port)
listener 8883

# Bind to localhost only (safer for testing)
bind_address localhost

# -----------------------------------------------------------------------------
# TLS Configuration
# -----------------------------------------------------------------------------

# Path to Certificate Authority certificate
# Clients use this same CA to verify the server
cafile certs/ca.pem

# Path to server certificate
# This proves the broker's identity to clients
certfile certs/server.pem

# Path to server private key
# Keep this file secure - it's the broker's secret
keyfile certs/server-key.pem

# TLS version (use modern TLS, not old SSL)
# tls_version tlsv1.2

# -----------------------------------------------------------------------------
# Client Certificate Settings
# -----------------------------------------------------------------------------

# Don't require client certificates (for basic TLS)
# Set to true for mutual TLS (mTLS) - covered in Project 5
require_certificate false

# If require_certificate is true, use this to verify client certs
# use_identity_as_username true

# -----------------------------------------------------------------------------
# Security Settings
# -----------------------------------------------------------------------------

# Allow connections without username/password
# We're using TLS for encryption, not authentication (yet)
allow_anonymous true

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------

# Log all events (useful for debugging)
log_type all

# Print logs to terminal
log_dest stdout

# -----------------------------------------------------------------------------
# Performance Settings
# -----------------------------------------------------------------------------

# Maximum messages to queue per client
max_queued_messages 1000

# Keepalive check interval
retry_interval 20

# =============================================================================
# Troubleshooting
# =============================================================================
#
# "Unable to load CA certificates"
#   → Check the cafile path is correct
#   → Make sure ca.pem exists in certs/ folder
#
# "Error loading server certificate"
#   → Check the certfile path is correct
#   → Make sure server.pem is a valid certificate
#
# "Error loading server key"
#   → Check the keyfile path is correct
#   → Make sure server-key.pem matches server.pem
#
# "Address already in use"
#   → Another Mosquitto is running
#   → Kill the other instance first
#
# =============================================================================
# End of configuration
# =============================================================================